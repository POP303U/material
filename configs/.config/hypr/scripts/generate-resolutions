#!/bin/sh

set -euo pipefail

AVAILABLE_MODES=$(hyprctl monitors -j | jq .[0].availableModes)
RESULT=""
INDEX="0"

# check if resolutions already exist
if ! [ -e $HOME/.config/hypr/resolutions ]; then
    mkdir -pv $HOME/.config/hypr/resolutions
else
    rm -r $HOME/.config/hypr/resolutions
    mkdir -pv $HOME/.config/hypr/resolutions
fi

generate_conf_file() {
    local RESOLUTION=$1

    echo "Got resolution: $RESOLUTION"

    local CONF_FILE="$HOME/.config/hypr/resolutions/${RESOLUTION}.conf"
    
    touch $CONF_FILE
    echo > $CONF_FILE
    echo -e '# Autogenerated resolution based on `hyprctl monitors`'        > $CONF_FILE
    echo -e '# see https://wiki.hyprland.org/configuring/monitors/'         >> $CONF_FILE
    echo -e '#'                                                             >> $CONF_FILE
    echo -e '#        <monitor>  <resolution@hz>     0x0    1      bitdepth  <bitdepth-value>' >> $CONF_FILE
    echo -e 'monitor=          , '$RESOLUTION'  , auto , auto , bitdepth , 10'                 >> $CONF_FILE
}

while true; do
    RESULT=$(echo $AVAILABLE_MODES | jq .[$INDEX] | tr =\"= " " | xargs)

    if [ "$RESULT" == "null" ]; then
        break
    fi

    generate_conf_file $RESULT

    INDEX=$((INDEX + 1))
done
